<div class="dialog-container">
  <div class="dialog-header">
    <div class="header-content">
      <h2 class="dialog-title">{{ titulo }}</h2>
      <p class="dialog-subtitle">
        {{
          esEdicion
            ? "Modifique los datos del ingreso de material"
            : "Complete los datos del ingreso de material al inventario"
        }}
      </p>
    </div>
    <button mat-icon-button mat-dialog-close class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form
    [formGroup]="ingresoForm"
    (ngSubmit)="onSubmit()"
    class="form-container"
  >
    <div class="dialog-content">
      <!-- Primera fila: Material y Fecha -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Material/Insumo</label>
          <select class="form-select" formControlName="id_insumo">
            <option value="">Seleccionar material</option>
            <option
              *ngFor="let material of materiales"
              [value]="material.id_insumo"
            >
              {{ material.id_fox }} - {{ material.nombre }}
            </option>
          </select>
          <div
            class="error-message"
            *ngIf="
              ingresoForm.get('id_insumo')?.hasError('required') &&
              ingresoForm.get('id_insumo')?.touched
            "
          >
            Debe seleccionar un material
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Fecha de Ingreso</label>
          <input class="form-input" type="date" formControlName="fecha" />
          <div
            class="error-message"
            *ngIf="
              ingresoForm.get('fecha')?.hasError('required') &&
              ingresoForm.get('fecha')?.touched
            "
          >
            La fecha es requerida
          </div>
        </div>
      </div>

      <!-- Segunda fila: Cantidad y Unidad -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Cantidad</label>
          <input
            class="form-input"
            type="number"
            formControlName="cantidad"
            placeholder="0.00"
            step="0.01"
            min="0.01"
          />
          <div
            class="error-message"
            *ngIf="
              ingresoForm.get('cantidad')?.hasError('required') &&
              ingresoForm.get('cantidad')?.touched
            "
          >
            La cantidad es requerida
          </div>
          <div
            class="error-message"
            *ngIf="
              ingresoForm.get('cantidad')?.hasError('min') &&
              ingresoForm.get('cantidad')?.touched
            "
          >
            La cantidad debe ser mayor a 0
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Unidad de Medida</label>
          <select class="form-select" formControlName="id_unidad">
            <option value="">Seleccionar unidad</option>
            <option *ngFor="let unidad of unidades" [value]="unidad.id_unidad">
              {{ unidad.nombre }} ({{ unidad.id_unidad }})
            </option>
          </select>
        </div>
      </div>

      <!-- Tercera fila: Presentación y Lote -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Presentación</label>
          <input
            class="form-input"
            formControlName="presentacion"
            placeholder="Ej: Rollo 50kg"
            maxlength="100"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Lote</label>
          <select class="form-select" formControlName="id_lote">
            <option value="">Seleccionar lote</option>
            <option *ngFor="let lote of lotes" [value]="lote.id_lote">
              {{ lote.lote }} - {{ lote.ubicacion }}
            </option>
          </select>
        </div>
      </div>

      <!-- Cuarta fila: Precios -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Precio Unitario Histórico (S/)</label>
          <input
            class="form-input"
            type="number"
            formControlName="precio_unitario_historico"
            placeholder="0.00"
            step="0.01"
            min="0"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Precio Total Fórmula (S/)</label>
          <input
            class="form-input"
            type="number"
            formControlName="precio_total_formula"
            placeholder="0.00"
            step="0.01"
            min="0"
            readonly
          />
        </div>
      </div>

      <!-- Quinta fila: Documentos -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Número de Remisión</label>
          <input
            class="form-input"
            formControlName="numero_remision"
            placeholder="Ej: REM-2024-001"
            maxlength="50"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Orden de Compra</label>
          <input
            class="form-input"
            formControlName="orden_compra"
            placeholder="Ej: OC-2024-001"
            maxlength="50"
          />
        </div>
      </div>

      <!-- Sexta fila: Proveedor y Estado -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Proveedor</label>
          <select class="form-select" formControlName="id_proveedor">
            <option value="">Seleccionar proveedor</option>
            <option
              *ngFor="let proveedor of proveedores"
              [value]="proveedor.id_proveedor"
            >
              {{ proveedor.empresa }} - {{ proveedor.ruc }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Estado</label>
          <select class="form-select" formControlName="estado">
            <option value="">Seleccionar estado</option>
            <option value="PENDIENTE">Pendiente</option>
            <option value="PROCESADO">Procesado</option>
            <option value="COMPLETADO">Completado</option>
            <option value="CANCELADO">Cancelado</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="dialog-actions">
      <button type="button" class="btn-cancel" (click)="onCancel()">
        Cancelar
      </button>
      <button type="submit" class="btn-save" [disabled]="!ingresoForm.valid">
        {{ esEdicion ? "Actualizar Ingreso" : "Registrar Ingreso" }}
      </button>
    </div>
  </form>
</div>
