<div class="page-container">
  <div class="page-content">
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title text-texfina text-primary">Dashboard</h1>
      </div>
      <div class="header-actions">
        <p-button
          label="Actualizar Datos"
          icon="pi pi-refresh"
          [loading]="isLoading"
          (onClick)="actualizarDashboard()"
          size="small"
        ></p-button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando métricas del dashboard...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="error-container">
      <i class="pi pi-exclamation-triangle"></i>
      <h3>Error al cargar dashboard</h3>
      <p>{{ errorMessage }}</p>
      <p-button
        label="Reintentar"
        icon="pi pi-refresh"
        (onClick)="reintentarCarga()"
        size="small"
      ></p-button>
    </div>

    <!-- Dashboard Content -->
    <div *ngIf="!isLoading && !hasError" class="dashboard-content">
      <!-- KPIs Row -->
      <div class="kpis-section">
        <div class="kpis-grid">
          <div class="kpi-card primary">
            <div class="kpi-icon">
              <i class="pi pi-box"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-value">
                {{ formatearNumero(resumen?.totalInsumos) }}
              </div>
              <div class="kpi-label">Total Insumos</div>
              <div class="kpi-trend positive">
                <i class="pi pi-arrow-up"></i>
                +3.2% vs mes anterior
              </div>
            </div>
          </div>

          <div class="kpi-card success">
            <div class="kpi-icon">
              <i class="pi pi-dollar"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-value">
                {{ formatearMoneda(resumen?.valorInventario) }}
              </div>
              <div class="kpi-label">Valor Inventario</div>
              <div class="kpi-trend positive">
                <i class="pi pi-arrow-up"></i>
                +5.8% vs mes anterior
              </div>
            </div>
          </div>

          <div class="kpi-card warning">
            <div class="kpi-icon">
              <i class="pi pi-exclamation-triangle"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-value">
                {{ formatearNumero(resumen?.stockCritico) }}
              </div>
              <div class="kpi-label">Stock Crítico</div>
              <div class="kpi-trend negative">
                <i class="pi pi-arrow-down"></i>
                -12% vs mes anterior
              </div>
            </div>
          </div>

          <div class="kpi-card info">
            <div class="kpi-icon">
              <i class="pi pi-users"></i>
            </div>
            <div class="kpi-content">
              <div class="kpi-value">
                {{ formatearNumero(resumen?.totalProveedores) }}
              </div>
              <div class="kpi-label">Proveedores Activos</div>
              <div class="kpi-trend stable">
                <i class="pi pi-minus"></i>
                Sin cambios
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <!-- Primera fila de gráficos -->
        <div class="charts-row">
          <!-- Gráfico de Inventario por Almacén -->
          <div class="chart-card">
            <p-card>
              <ng-template pTemplate="header">
                <div class="chart-header">
                  <h3>
                    <i class="pi pi-chart-pie"></i>
                    Distribución de Inventario
                  </h3>
                  <span class="chart-subtitle">Por almacén</span>
                </div>
              </ng-template>
              <div class="chart-container pie-chart">
                <p-chart
                  type="doughnut"
                  [data]="inventarioChartData"
                  [options]="inventarioChartOptions"
                  ariaLabel="Distribución de inventario por almacén"
                ></p-chart>
              </div>
            </p-card>
          </div>

          <!-- Gráfico de Tendencia de Stock -->
          <div class="chart-card large">
            <p-card>
              <ng-template pTemplate="header">
                <div class="chart-header">
                  <h3>
                    <i class="pi pi-chart-line"></i>
                    Tendencia de Stock
                  </h3>
                  <span class="chart-subtitle">Últimos 6 meses</span>
                </div>
              </ng-template>
              <div class="chart-container line-chart">
                <p-chart
                  type="line"
                  [data]="stockTendenciaData"
                  [options]="stockTendenciaOptions"
                  ariaLabel="Tendencia de stock en los últimos meses"
                ></p-chart>
              </div>
            </p-card>
          </div>
        </div>

        <!-- Segunda fila de gráficos -->
        <div class="charts-row">
          <!-- Gráfico de Movimientos -->
          <div class="chart-card">
            <p-card>
              <ng-template pTemplate="header">
                <div class="chart-header">
                  <h3>
                    <i class="pi pi-chart-bar"></i>
                    Movimientos Mensuales
                  </h3>
                  <span class="chart-subtitle"
                    >Ingresos, salidas y transferencias</span
                  >
                </div>
              </ng-template>
              <div class="chart-container bar-chart">
                <p-chart
                  type="bar"
                  [data]="movimientosBarData"
                  [options]="movimientosBarOptions"
                  ariaLabel="Movimientos mensuales de inventario"
                ></p-chart>
              </div>
            </p-card>
          </div>

          <!-- Gráfico de Top Proveedores -->
          <div class="chart-card">
            <p-card>
              <ng-template pTemplate="header">
                <div class="chart-header">
                  <h3>
                    <i class="pi pi-building"></i>
                    Top Proveedores
                  </h3>
                  <span class="chart-subtitle">Por valor de compras</span>
                </div>
              </ng-template>
              <div class="chart-container horizontal-bar-chart">
                <p-chart
                  type="bar"
                  [data]="proveedoresData"
                  [options]="proveedoresOptions"
                  ariaLabel="Top proveedores por valor de compras"
                ></p-chart>
              </div>
            </p-card>
          </div>
        </div>

        <!-- Tercera fila de gráficos -->
        <div class="charts-row">
          <!-- Gráfico de Consumos por Área -->
          <div class="chart-card">
            <p-card>
              <ng-template pTemplate="header">
                <div class="chart-header">
                  <h3>
                    <i class="pi pi-chart-pie"></i>
                    Consumos por Área
                  </h3>
                  <span class="chart-subtitle">Distribución mensual</span>
                </div>
              </ng-template>
              <div class="chart-container polar-chart">
                <p-chart
                  type="polarArea"
                  [data]="consumosPorTipoData"
                  [options]="consumosPorTipoOptions"
                  ariaLabel="Consumos por área de trabajo"
                ></p-chart>
              </div>
            </p-card>
          </div>

          <!-- Panel de Alertas -->
          <div class="chart-card">
            <p-card>
              <ng-template pTemplate="header">
                <div class="chart-header">
                  <h3>
                    <i class="pi pi-bell"></i>
                    Alertas Recientes
                  </h3>
                  <span class="chart-subtitle"
                    >{{ alertas.length }} alertas activas</span
                  >
                </div>
              </ng-template>
              <div class="alerts-container">
                <div
                  *ngFor="let alerta of alertas; let i = index"
                  class="alert-item"
                  [class]="'alert-' + alerta.nivel.toLowerCase()"
                >
                  <div class="alert-icon">
                    <i [class]="getAlertIcon(alerta.tipo)"></i>
                  </div>
                  <div class="alert-content">
                    <h4>{{ alerta.titulo }}</h4>
                    <p>{{ alerta.descripcion }}</p>
                    <div class="alert-meta">
                      <span class="alert-time"
                        >{{ formatearFecha(alerta.fechaCreacion) }}</span
                      >
                      <span class="alert-location">{{ alerta.almacen }}</span>
                    </div>
                  </div>
                  <div class="alert-actions">
                    <p-button
                      icon="pi pi-check"
                      [text]="true"
                      [rounded]="true"
                      size="small"
                      (onClick)="resolverAlerta(alerta)"
                      pTooltip="Resolver alerta"
                    ></p-button>
                  </div>
                </div>

                <div *ngIf="alertas.length === 0" class="no-alerts">
                  <i class="pi pi-check-circle"></i>
                  <p>No hay alertas activas</p>
                </div>
              </div>
            </p-card>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
