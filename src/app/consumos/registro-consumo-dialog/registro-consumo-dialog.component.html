<div class="dialog-container">
  <div class="dialog-header">
    <div class="header-content">
      <h2 class="dialog-title">{{ titulo }}</h2>
      <p class="dialog-subtitle">{{ subtitulo }}</p>
    </div>
    <button mat-icon-button mat-dialog-close class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="dialog-content">
    <form [formGroup]="consumoForm" class="form-container">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label"
            >Fecha <span class="required">*</span></label
          >
          <input
            type="date"
            class="form-input"
            formControlName="fecha"
            [class.error]="isFieldInvalid('fecha')"
          />
          <div class="error-message" *ngIf="isFieldInvalid('fecha')">
            La fecha es obligatoria
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Área <span class="required">*</span></label>
          <select
            class="form-input"
            formControlName="area"
            [class.error]="isFieldInvalid('area')"
          >
            <option value="">Seleccionar área</option>
            <option value="Producción">Producción</option>
            <option value="Empaque">Empaque</option>
            <option value="Mantenimiento">Mantenimiento</option>
            <option value="Laboratorio">Laboratorio</option>
            <option value="Administración">Administración</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('area')">
            El área es obligatoria
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label"
            >Insumo <span class="required">*</span></label
          >
          <select
            class="form-input"
            formControlName="id_insumo"
            [class.error]="isFieldInvalid('id_insumo')"
            (change)="onInsumoChange()"
          >
            <option value="">Seleccionar insumo</option>
            <option [value]="insumo.id_insumo" *ngFor="let insumo of insumos">
              {{ insumo.nombre }} ({{ insumo.id_fox || "Sin código" }})
            </option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('id_insumo')">
            El insumo es obligatorio
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Lote</label>
          <select class="form-input" formControlName="id_lote">
            <option value="">Sin lote específico</option>
            <option [value]="lote.id_lote" *ngFor="let lote of lotes">
              {{ lote.lote }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label"
            >Cantidad <span class="required">*</span></label
          >
          <input
            type="number"
            step="0.01"
            min="0"
            class="form-input"
            formControlName="cantidad"
            [class.error]="isFieldInvalid('cantidad')"
            placeholder="0.00"
          />
          <div class="error-message" *ngIf="isFieldInvalid('cantidad')">
            La cantidad debe ser mayor a 0
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Unidad</label>
          <input
            type="text"
            class="form-input"
            [value]="unidadSeleccionada"
            readonly
            placeholder="Seleccionar insumo para ver unidad"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Responsable</label>
          <input
            type="text"
            class="form-input"
            formControlName="responsable"
            placeholder="Nombre del responsable"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Estado</label>
          <select class="form-input" formControlName="estado">
            <option value="PENDIENTE">Pendiente</option>
            <option value="CONSUMIDO">Consumido</option>
            <option value="ANULADO">Anulado</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group form-group-full">
          <label class="form-label">Observaciones</label>
          <textarea
            class="form-textarea"
            formControlName="observaciones"
            rows="3"
            placeholder="Observaciones adicionales del consumo"
          ></textarea>
        </div>
      </div>
    </form>
  </div>

  <div class="dialog-actions">
    <button type="button" class="btn-cancel" mat-dialog-close>Cancelar</button>
    <button
      type="button"
      class="btn-save"
      (click)="onSubmit()"
      [disabled]="consumoForm.invalid || isSubmitting"
    >
      <span *ngIf="!isSubmitting">{{ textoBoton }}</span>
      <span *ngIf="isSubmitting">Guardando...</span>
    </button>
  </div>
</div>
