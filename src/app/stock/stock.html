<div class="stock-container page-container">
  <!-- Header de la página -->
  <div class="page-header">
    <h1 class="page-title">Consulta de Stock</h1>
    <div class="action-buttons">
      <button
        mat-raised-button
        class="btn-texfina btn-primary"
        (click)="exportarExcel()"
      >
        <mat-icon>file_download</mat-icon>
        Exportar Excel
      </button>
    </div>
  </div>

  <!-- Cards de resumen -->
  <div class="summary-cards">
    <div class="card-texfina">
      <div class="card-content">
        <div class="summary-value text-texfina text-primary">
          {{ formatearNumero(totalItems) }}
        </div>
        <div class="summary-label text-texfina text-muted">Total de Items</div>
      </div>
    </div>

    <div class="card-texfina">
      <div class="card-content">
        <div class="summary-value text-texfina text-secondary">
          {{ formatearMoneda(valorTotalInventario) }}
        </div>
        <div class="summary-label text-texfina text-muted">
          Valor Total Inventario
        </div>
      </div>
    </div>

    <div class="card-texfina warning-card">
      <div class="card-content">
        <div class="summary-value text-texfina text-warning">
          {{ formatearNumero(itemsCriticos) }}
        </div>
        <div class="summary-label text-texfina text-muted">Items Críticos</div>
      </div>
    </div>

    <div class="card-texfina attention-card">
      <div class="card-content">
        <div class="summary-value text-texfina text-warning">
          {{ formatearNumero(itemsBajos) }}
        </div>
        <div class="summary-label text-texfina text-muted">
          Items con Stock Bajo
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <mat-card class="filtros-card">
    <div class="card-header">
      <h3 class="card-title">Filtros de Búsqueda</h3>
    </div>
    <div class="card-content">
      <form [formGroup]="filtrosForm" class="filtros-form">
        <div class="filtros-row">
          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Código Fox</mat-label>
            <input matInput formControlName="codigo" placeholder="Ej: ALG001" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Nombre del Material</mat-label>
            <input
              matInput
              formControlName="nombre"
              placeholder="Ej: Algodón"
            />
          </mat-form-field>

          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Almacén</mat-label>
            <mat-select formControlName="almacen">
              <mat-option value="">Todos los almacenes</mat-option>
              <mat-option
                *ngFor="let almacen of almacenes"
                [value]="almacen.id_almacen.toString()"
              >
                {{ almacen.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Clase</mat-label>
            <mat-select formControlName="clase">
              <mat-option value="">Todas las clases</mat-option>
              <mat-option
                *ngFor="let clase of clases"
                [value]="clase.id_clase.toString()"
              >
                {{ clase.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="filtros-row">
          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Estado de Stock</mat-label>
            <mat-select formControlName="estado_stock">
              <mat-option value="">Todos los estados</mat-option>
              <mat-option value="CRITICO">Crítico</mat-option>
              <mat-option value="BAJO">Bajo</mat-option>
              <mat-option value="NORMAL">Normal</mat-option>
              <mat-option value="ALTO">Alto</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Stock Mínimo</mat-label>
            <input
              matInput
              type="number"
              formControlName="stock_minimo"
              placeholder="0"
            />
          </mat-form-field>

          <mat-form-field appearance="outline" class="filtro-field">
            <mat-label>Stock Máximo</mat-label>
            <input
              matInput
              type="number"
              formControlName="stock_maximo"
              placeholder="0"
            />
          </mat-form-field>

          <div class="filtro-buttons">
            <button
              mat-raised-button
              class="btn-texfina btn-primary"
              (click)="buscar()"
            >
              <mat-icon>search</mat-icon>
              Buscar
            </button>

            <button
              mat-stroked-button
              class="btn-texfina btn-outline-primary"
              (click)="limpiarFiltros()"
            >
              <mat-icon>clear</mat-icon>
              Limpiar
            </button>
          </div>
        </div>
      </form>
    </div>
  </mat-card>

  <!-- Tabla de stock -->
  <div class="page-content">
    <mat-card class="table-card">
      <div class="card-header">
        <h3 class="card-title">Stock de Materiales</h3>
        <p class="card-subtitle">
          Mostrando {{ stocksFiltrados.length }} de {{ stocks.length }}
          registros
        </p>
      </div>
      <div class="card-content">
        <div class="table-container">
          <table mat-table [dataSource]="stocksFiltrados" class="stock-table">
            <!-- Columna Código -->
            <ng-container matColumnDef="codigo">
              <th mat-header-cell *matHeaderCellDef>Código Fox</th>
              <td mat-cell *matCellDef="let stock">
                <span class="badge-texfina badge-neutral"
                  >{{ formatearCodigo(stock.codigo_fox) }}</span
                >
              </td>
            </ng-container>

            <!-- Columna Material -->
            <ng-container matColumnDef="material">
              <th mat-header-cell *matHeaderCellDef>Material</th>
              <td mat-cell *matCellDef="let stock">
                <div class="material-cell">
                  <div class="material-name text-texfina">
                    {{ stock.nombre }}
                  </div>
                  <div class="material-unit text-texfina text-muted">
                    {{ stock.unidad }}
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Columna Almacén -->
            <ng-container matColumnDef="almacen">
              <th mat-header-cell *matHeaderCellDef>Almacén</th>
              <td mat-cell *matCellDef="let stock">
                <span class="badge-texfina badge-secondary"
                  >{{ stock.almacen }}</span
                >
              </td>
            </ng-container>

            <!-- Columna Stock Actual -->
            <ng-container matColumnDef="stock_actual">
              <th mat-header-cell *matHeaderCellDef>Stock Actual</th>
              <td mat-cell *matCellDef="let stock">
                <span
                  class="stock-value"
                  [ngClass]="getEstadoStockClass(stock.estado_stock)"
                >
                  {{ formatearNumero(stock.stock_actual) }}
                </span>
              </td>
            </ng-container>

            <!-- Columna Estado -->
            <ng-container matColumnDef="estado">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let stock">
                <span
                  class="badge-texfina"
                  [ngClass]="getEstadoBadgeClass(stock.estado_stock)"
                >
                  {{ stock.estado_stock }}
                </span>
              </td>
            </ng-container>

            <!-- Columna Valor -->
            <ng-container matColumnDef="valor">
              <th mat-header-cell *matHeaderCellDef>Valor Total</th>
              <td mat-cell *matCellDef="let stock">
                <span class="text-texfina"
                  >{{ formatearMoneda(stock.valor_total) }}</span
                >
              </td>
            </ng-container>

            <!-- Definición de headers y filas -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </div>
      </div>
    </mat-card>
  </div>
</div>
