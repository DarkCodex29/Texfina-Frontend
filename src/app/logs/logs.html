<div class="logs-container">
  <!-- Header de la página -->
  <div class="page-header">
    <h1 class="page-title">Auditoría y Logs del Sistema</h1>
    <div class="action-buttons">
      <button
        mat-raised-button
        color="primary"
        (click)="exportarLogs()"
        class="btn-exportar"
      >
        <mat-icon>download</mat-icon>
        Exportar Logs
      </button>
    </div>
  </div>

  <!-- Tarjeta de filtros avanzados -->
  <mat-card class="filtros-card">
    <form [formGroup]="filtrosForm" (ngSubmit)="buscar()" class="filtros-form">
      <!-- Primera fila de filtros -->
      <div class="filtros-row">
        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Usuario</mat-label>
          <mat-select formControlName="usuario">
            <mat-option value="">Todos los usuarios</mat-option>
            <mat-option
              *ngFor="let usuario of usuarios"
              [value]="usuario.id_usuario"
            >
              {{ usuario.username }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Módulo</mat-label>
          <mat-select formControlName="modulo">
            <mat-option value="">Todos los módulos</mat-option>
            <mat-option
              *ngFor="let modulo of modulosDisponibles"
              [value]="modulo"
            >
              {{ modulo }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Acción</mat-label>
          <mat-select formControlName="accion">
            <mat-option value="">Todas las acciones</mat-option>
            <mat-option
              *ngFor="let accion of accionesDisponibles"
              [value]="accion"
            >
              {{ accion }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Tabla Afectada</mat-label>
          <input
            matInput
            formControlName="tabla_afectada"
            placeholder="Ej: USUARIO, INSUMO"
          />
        </mat-form-field>
      </div>

      <!-- Segunda fila de filtros -->
      <div class="filtros-row">
        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>IP de Origen</mat-label>
          <input
            matInput
            formControlName="ip_origen"
            placeholder="Ej: 192.168.1.100"
          />
        </mat-form-field>

        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Fecha Desde</mat-label>
          <input
            matInput
            [matDatepicker]="pickerDesde"
            formControlName="fecha_desde"
            placeholder="Seleccionar fecha"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerDesde"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerDesde></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Fecha Hasta</mat-label>
          <input
            matInput
            [matDatepicker]="pickerHasta"
            formControlName="fecha_hasta"
            placeholder="Seleccionar fecha"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerHasta"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerHasta></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filtro-field">
          <mat-label>Descripción</mat-label>
          <input
            matInput
            formControlName="descripcion"
            placeholder="Buscar en descripción"
          />
        </mat-form-field>
      </div>

      <!-- Botones de acción -->
      <div class="filtros-buttons">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="btn-buscar"
        >
          <mat-icon>search</mat-icon>
          Buscar
        </button>
        <button
          mat-stroked-button
          color="accent"
          type="button"
          (click)="limpiarFiltros()"
          class="btn-limpiar"
        >
          <mat-icon>clear</mat-icon>
          Limpiar
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Tarjeta de tabla de logs -->
  <mat-card class="tabla-card">
    <div class="table-container">
      <table mat-table [dataSource]="logs" class="logs-table" matSort>
        <!-- Columna Timestamp -->
        <ng-container matColumnDef="timestamp">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            class="th-timestamp"
          >
            Fecha y Hora
          </th>
          <td mat-cell *matCellDef="let log" class="td-timestamp">
            <div class="timestamp-info">
              <span class="fecha">{{ formatearFecha(log.timestamp) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Usuario -->
        <ng-container matColumnDef="usuario">
          <th mat-header-cell *matHeaderCellDef class="th-usuario">Usuario</th>
          <td mat-cell *matCellDef="let log" class="td-usuario">
            <div class="usuario-info">
              <mat-icon class="user-icon">person</mat-icon>
              <span class="user-name"
                >{{ getNombreUsuario(log.id_usuario) }}</span
              >
            </div>
          </td>
        </ng-container>

        <!-- Columna Acción -->
        <ng-container matColumnDef="accion">
          <th mat-header-cell *matHeaderCellDef class="th-accion">Acción</th>
          <td mat-cell *matCellDef="let log" class="td-accion">
            <mat-chip-set>
              <mat-chip
                [class]="'chip-' + getColorAccion(log.accion)"
                [class.severity]="getNivelSeveridad(log.accion)"
              >
                {{ log.accion }}
              </mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <!-- Columna Módulo -->
        <ng-container matColumnDef="modulo">
          <th mat-header-cell *matHeaderCellDef class="th-modulo">Módulo</th>
          <td mat-cell *matCellDef="let log" class="td-modulo">
            <span class="modulo-badge">{{ log.modulo || '-' }}</span>
          </td>
        </ng-container>

        <!-- Columna Tabla Afectada -->
        <ng-container matColumnDef="tabla_afectada">
          <th mat-header-cell *matHeaderCellDef class="th-tabla">Tabla</th>
          <td mat-cell *matCellDef="let log" class="td-tabla">
            <code class="table-name">{{ log.tabla_afectada || '-' }}</code>
          </td>
        </ng-container>

        <!-- Columna Descripción -->
        <ng-container matColumnDef="descripcion">
          <th mat-header-cell *matHeaderCellDef class="th-descripcion">
            Descripción
          </th>
          <td mat-cell *matCellDef="let log" class="td-descripcion">
            <span
              class="descripcion-text"
              [matTooltip]="log.descripcion"
              matTooltipClass="custom-tooltip"
            >
              {{ log.descripcion || '-' }}
            </span>
          </td>
        </ng-container>

        <!-- Columna IP -->
        <ng-container matColumnDef="ip_origen">
          <th mat-header-cell *matHeaderCellDef class="th-ip">IP Origen</th>
          <td mat-cell *matCellDef="let log" class="td-ip">
            <code class="ip-address">{{ log.ip_origen || '-' }}</code>
          </td>
        </ng-container>

        <!-- Columna Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="th-acciones">
            Acciones
          </th>
          <td mat-cell *matCellDef="let log" class="td-acciones">
            <div class="action-buttons">
              <button
                mat-icon-button
                (click)="verDetalleLogs(log)"
                matTooltip="Ver detalle completo"
                class="btn-detalle"
              >
                <mat-icon>visibility</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <!-- Headers y filas -->
        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns; sticky: true"
        ></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Estado sin datos -->
      <div *ngIf="logs.length === 0" class="no-data">
        <mat-icon>assignment</mat-icon>
        <p>No se encontraron logs con los filtros aplicados</p>
        <button mat-raised-button color="primary" (click)="limpiarFiltros()">
          <mat-icon>refresh</mat-icon>
          Mostrar todos los logs
        </button>
      </div>
    </div>

    <!-- Información de paginación -->
    <div class="pagination-container">
      <div class="pagination-info">
        <span>Mostrando {{ logs.length }} registros</span>
      </div>
      <div class="pagination-buttons">
        <button mat-icon-button disabled>
          <mat-icon>first_page</mat-icon>
        </button>
        <button mat-icon-button disabled>
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-icon-button disabled>
          <mat-icon>chevron_right</mat-icon>
        </button>
        <button mat-icon-button disabled>
          <mat-icon>last_page</mat-icon>
        </button>
      </div>
    </div>
  </mat-card>
</div>
